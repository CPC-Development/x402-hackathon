version: "3.9"

services:
  hardhat:
    build:
      context: ../contracts/hardhat
      dockerfile: Dockerfile
    profiles: ["todo"]
    command: ["sh", "-c", "echo TODO: add hardhat Dockerfile; sleep infinity"]
    env_file:
      - ./ports.env
    ports:
      - "${HARDHAT_PORT:-8545}:8545"

  facilitator:
    build:
      context: ../facilitator/x402-rs
      dockerfile: Dockerfile
    profiles: ["facilitator"]
    env_file:
      - ./ports.env
    ports:
      - "${FACILITATOR_PORT:-8080}:8080"
    volumes:
      - ../facilitator/x402-rs/config.json:/app/config.json:ro
    environment:
      - RUST_LOG=info

  sequencer:
    build:
      context: ../apps/sequencer
      dockerfile: Dockerfile
    profiles: ["todo"]
    command: ["sh", "-c", "echo TODO: add sequencer Dockerfile; sleep infinity"]
    env_file:
      - ./ports.env
    ports:
      - "${SEQUENCER_PORT:-4001}:4001"

  service:
    build:
      context: ../apps/service
      dockerfile: Dockerfile
    profiles: ["todo"]
    command: ["sh", "-c", "echo TODO: add service Dockerfile; sleep infinity"]
    env_file:
      - ./ports.env
    ports:
      - "${SERVICE_PORT:-4000}:4000"

networks:
  default:
    name: x402_demo
